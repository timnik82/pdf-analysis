=== Fetching all feedback for PR #3 ===

PR Details:
-----------
PR #3: feat: Add DOI extraction and Mendeley library comparison tool
State: open
Author: @timnik82
Created: 2026-01-19T10:42:14Z
Updated: 2026-01-19T10:56:13Z
Branch: feature/doi-extraction-html-table ‚Üí main
URL: https://github.com/timnik82/pdf-analysis/pull/3

Description:
## **User description**
- Add extract_and_check_dois.py: Extracts DOIs from markdown files and checks them against Mendeley library, generating an interactive HTML table showing which DOIs are in/not in the library
- Update check_mendeley_dois_v2.py: Modify OAuth flow to support WSL environment by using manual URL paste instead of local callback server
- Output HTML is saved to the same directory as the input markdown file
- All DOI links in the HTML are clickable


___

## **CodeAnt-AI Description**
Add DOI extractor that generates a clickable HTML table and make Mendeley auth work in WSL

### What Changed
- New command-line tool extracts DOIs from a markdown file and produces an interactive HTML report saved next to the markdown file
- HTML report shows totals and two columns ("Already in Library" and "Not in Library") with clickable DOI links, titles, years, and clear empty-state messages
- The extractor runs the existing Mendeley check and presents results; it cleans up temporary files and prints progress messages
- Mendeley OAuth flow no longer relies on opening a browser and a local callback server ‚Äî users paste the redirect URL into the terminal; the script validates the pasted URL and errors if no code is found

### Impact
`‚úÖ Shorter DOI-to-library workflow`
`‚úÖ Clearer DOI presence report with clickable links`
`‚úÖ Works on WSL and headless environments without local callback`
<details>
<summary><strong>üí° Usage Guide</strong></summary>

### Checking Your Pull Request
Every time you make a pull request, our system automatically looks through it. We check for security issues, mistakes in how you're setting up your infrastructure, and common code problems. We do this to make sure your changes are solid and won't cause any trouble later.

### Talking to CodeAnt AI
Got a question or need a hand with something in your pull request? You can easily get in touch with CodeAnt AI right here. Just type the following in a comment on your pull request, and replace "Your question here" with whatever you want to ask:
<pre>
<code>@codeant-ai ask: Your question here</code>
</pre>
This lets you have a chat with CodeAnt AI about your pull request, making it easier to understand and improve your code.

#### Example
<pre>
<code>@codeant-ai ask: Can you suggest a safer alternative to storing this secret?</code>
</pre>

### Preserve Org Learnings with CodeAnt
You can record team preferences so CodeAnt AI applies them in future reviews. Reply directly to the specific CodeAnt AI suggestion (in the same thread) and replace "Your feedback here" with your input:
<pre>
<code>@codeant-ai: Your feedback here</code>
</pre>
This helps CodeAnt AI learn and adapt to your team's coding style and standards.

#### Example
<pre>
<code>@codeant-ai: Do not flag unused imports.</code>
</pre>

### Retrigger review
Ask CodeAnt AI to review the PR again, by typing:
<pre>
<code>@codeant-ai: review</code>
</pre>

### Check Your Repository Health
To analyze the health of your code repository, visit our dashboard at [https://app.codeant.ai](https://app.codeant.ai). This tool helps you identify potential issues and areas for improvement in your codebase, ensuring your repository maintains high standards of code health.

</details>


Stats:
  Commits: 2
  Changed files: 2
  Additions: +242
  Deletions: -45


General Comments:
----------------

@codeant-ai[bot] - 2026-01-19T10:42:19Z
CodeAnt AI is reviewing your PR.
URL: https://github.com/timnik82/pdf-analysis/pull/3#issuecomment-3767654553
--------------------------------------------------------------------------------

@coderabbitai[bot] - 2026-01-19T10:42:26Z
<!-- This is an auto-generated comment: summarize by coderabbit.ai -->
<!-- This is an auto-generated comment: review in progress by coderabbit.ai -->

> [!NOTE]
> Currently processing new changes in this PR. This may take a few minutes, please wait...
> 
> <details>
> <summary>üì• Commits</summary>
> 
> Reviewing files that changed from the base of the PR and between 5ece490e51894d870a9c44adc6887544685fab58 and 161ac21c64feb9500bc861b5e33927eedce5cbcf.
> 
> </details>
> 
> <details>
> <summary>üìí Files selected for processing (2)</summary>
> 
> * `check_mendeley_dois_v2.py`
> * `extract_and_check_dois.py`
> 
> </details>
> 
> ```ascii
>  _________________________________________
> < Tensor cores warmed; bug cores chilled. >
>  -----------------------------------------
>   \
>    \   \
>         \ /\
>         ( )
>       .( o ).
> ```
> 
> <sub>‚úèÔ∏è Tip: You can disable in-progress messages and the fortune message in your review settings.</sub>

<!-- end of auto-generated comment: review in progress by coderabbit.ai -->
<!-- usage_tips_start -->

> [!TIP]
> <details>
> <summary>You can disable the changed files summary in the walkthrough.</summary>
> 
> Disable the `reviews.changed_files_summary` setting in your project's settings in CodeRabbit to disable the changed files summary in the walkthrough.
> 
> </details>

<!-- usage_tips_end -->
<!-- other_code_reviewer_warning_start -->

> [!NOTE]
> ## Other AI code review bot(s) detected
> 
> CodeRabbit has detected other AI code review bot(s) in this pull request and will avoid duplicating their findings in the review comments. This may lead to a less comprehensive review.

<!-- other_code_reviewer_warning_end -->

<!-- walkthrough_start -->

## Walkthrough

The changes involve two scripts: one modifies OAuth authentication in `check_mendeley_dois_v2.py` from automatic browser-based flow to manual URL parsing, and the other introduces a new script `extract_and_check_dois.py` that extracts DOIs from Markdown, validates them against Mendeley, and generates HTML reports.

## Changes

| Cohort / File(s) | Summary |
|---|---|
| **OAuth Flow Modification**<br>`check_mendeley_dois_v2.py` | Replaced browser-based OAuth with manual flow: removes HTTP server initialization, browser launch, and automatic redirect capture. Users now paste the full redirect URL; the script parses and validates the authorization code. Error handling added for missing code parameter. Net change: +15/-11 lines. |
| **New DOI Extraction and Reporting**<br>`extract_and_check_dois.py` | New script that extracts DOIs from Markdown files using regex patterns, invokes `check_mendeley_dois_v2.py` for validation, and generates a styled HTML table report showing DOIs organized by Mendeley library membership status. Includes functions for extraction, Mendeley checking, and HTML generation. Net change: +223 lines. |

## Possibly related PRs

- timnik82/pdf-analysis#1: Modifies the same OAuth authentication flow in `check_mendeley_dois_v2.py`, transitioning from browser-based to manual URL parsing approach.

<!-- walkthrough_end -->

<!-- pre_merge_checks_walkthrough_start -->

<details>
<summary>üö• Pre-merge checks | ‚úÖ 3</summary>

<details>
<summary>‚úÖ Passed checks (3 passed)</summary>

|     Check name     | Status   | Explanation                                                                                                                                                                                                                        |
| :----------------: | :------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|     Title check    | ‚úÖ Passed | The PR title accurately describes the main changes: adding a new DOI extraction and Mendeley library comparison tool, which aligns with the introduction of extract_and_check_dois.py and the update to check_mendeley_dois_v2.py. |
| Docstring Coverage | ‚úÖ Passed | Docstring coverage is 80.00% which is sufficient. The required threshold is 80.00%.                                                                                                                                                |
|  Description check | ‚úÖ Passed | The PR description comprehensively outlines the two main changes: a new DOI extraction tool and an updated OAuth flow for WSL compatibility, which directly align with the changeset.                                              |

</details>

<sub>‚úèÔ∏è Tip: You can configure your own custom pre-merge checks in the settings.</sub>

</details>

<!-- pre_merge_checks_walkthrough_end -->

<!-- finishing_touch_checkbox_start -->

<details>
<summary>‚ú® Finishing touches</summary>

- [ ] <!-- {"checkboxId": "7962f53c-55bc-4827-bfbf-6a18da830691"} --> üìù Generate docstrings
<details>
<summary>üß™ Generate unit tests (beta)</summary>

- [ ] <!-- {"checkboxId": "f47ac10b-58cc-4372-a567-0e02b2c3d479", "radioGroupId": "utg-output-choice-group-unknown_comment_id"} -->   Create PR with unit tests
- [ ] <!-- {"checkboxId": "07f1e7d6-8a8e-4e23-9900-8731c2c87f58", "radioGroupId": "utg-output-choice-group-unknown_comment_id"} -->   Post copyable unit tests in a comment
- [ ] <!-- {"checkboxId": "6ba7b810-9dad-11d1-80b4-00c04fd430c8", "radioGroupId": "utg-output-choice-group-unknown_comment_id"} -->   Commit unit tests in branch `feature/doi-extraction-html-table`

</details>

</details>

<!-- finishing_touch_checkbox_end -->

<!-- tips_start -->

---

Thanks for using [CodeRabbit](https://coderabbit.ai?utm_source=oss&utm_medium=github&utm_campaign=timnik82/pdf-analysis&utm_content=3)! It's free for OSS, and your support helps us grow. If you like it, consider giving us a shout-out.

<details>
<summary>‚ù§Ô∏è Share</summary>

- [X](https://twitter.com/intent/tweet?text=I%20just%20used%20%40coderabbitai%20for%20my%20code%20review%2C%20and%20it%27s%20fantastic%21%20It%27s%20free%20for%20OSS%20and%20offers%20a%20free%20trial%20for%20the%20proprietary%20code.%20Check%20it%20out%3A&url=https%3A//coderabbit.ai)
- [Mastodon](https://mastodon.social/share?text=I%20just%20used%20%40coderabbitai%20for%20my%20code%20review%2C%20and%20it%27s%20fantastic%21%20It%27s%20free%20for%20OSS%20and%20offers%20a%20free%20trial%20for%20the%20proprietary%20code.%20Check%20it%20out%3A%20https%3A%2F%2Fcoderabbit.ai)
- [Reddit](https://www.reddit.com/submit?title=Great%20tool%20for%20code%20review%20-%20CodeRabbit&text=I%20just%20used%20CodeRabbit%20for%20my%20code%20review%2C%20and%20it%27s%20fantastic%21%20It%27s%20free%20for%20OSS%20and%20offers%20a%20free%20trial%20for%20proprietary%20code.%20Check%20it%20out%3A%20https%3A//coderabbit.ai)
- [LinkedIn](https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fcoderabbit.ai&mini=true&title=Great%20tool%20for%20code%20review%20-%20CodeRabbit&summary=I%20just%20used%20CodeRabbit%20for%20my%20code%20review%2C%20and%20it%27s%20fantastic%21%20It%27s%20free%20for%20OSS%20and%20offers%20a%20free%20trial%20for%20proprietary%20code)

</details>

<sub>Comment `@coderabbitai help` to get the list of available commands and usage tips.</sub>

<!-- tips_end -->

<!-- internal state start -->


<!-- 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 -->

<!-- internal state end -->
URL: https://github.com/timnik82/pdf-analysis/pull/3#issuecomment-3767655010
--------------------------------------------------------------------------------

@gemini-code-assist[bot] - 2026-01-19T10:42:30Z
## Summary of Changes

Hello @timnik82, I'm Gemini Code Assist[^1]! I'm currently reviewing this pull request and will post my feedback shortly. In the meantime, here's a summary to help you and other reviewers quickly get up to speed!

This pull request significantly enhances the utility for managing academic references by introducing a new tool that automates the extraction of DOIs from markdown documents and cross-references them with a user's Mendeley library. It provides a clear, interactive HTML report of the comparison, making it easier to track and organize research materials. Additionally, the underlying Mendeley authentication mechanism has been made more robust, particularly for non-standard environments.

### Highlights

* **New Tool for DOI Management**: A new Python script (`extract_and_check_dois.py`) has been added to automatically extract DOIs from markdown files.
* **Mendeley Library Comparison**: The new script integrates with the existing Mendeley checker to compare extracted DOIs against the user's Mendeley library.
* **Interactive HTML Report**: Results are presented in a user-friendly, interactive HTML table, clearly showing which DOIs are present or missing from the library, with clickable links.
* **Improved OAuth Flow**: The `check_mendeley_dois_v2.py` script's OAuth authentication process has been updated to support environments like WSL by switching to a manual URL paste method, enhancing compatibility.









<details>
<summary><b>Using Gemini Code Assist</b></summary>
<br>

The full guide for Gemini Code Assist can be found on our [documentation page](https://developers.google.com/gemini-code-assist/docs/review-github-code), here are some quick tips.

<b>Invoking Gemini</b>

You can request assistance from Gemini at any point by creating a comment using either `/gemini <command>` or `@gemini-code-assist <command>`. Below is a summary of the supported commands on the current page.

Feature | Command | Description
--- | --- | ---
Code Review | `/gemini review` | Performs a code review for the current pull request in its current state.
Pull Request Summary | `/gemini summary` | Provides a summary of the current pull request in its current state.
Comment | @gemini-code-assist | Responds in comments when explicitly tagged, both in pull request comments and review comments.
Help | `/gemini help` | Displays a list of available commands.

<b>Customization</b>

To customize Gemini Code Assist for GitHub experience, repository maintainers can create a configuration file and/or provide a custom code review style guide (such as PEP-8 for Python) by creating and adding files to a `.gemini/` folder in the base of the repository. Detailed instructions can be found [here](https://developers.google.com/gemini-code-assist/docs/customize-gemini-behavior-github).

<b>Limitations & Feedback</b>

Gemini Code Assist may make mistakes. Please leave feedback on any instances where its feedback is incorrect or counter productive. You can react with :thumbsup: and :thumbsdown: on @gemini-code-assist comments. If you're interested in giving your feedback about your experience with Gemini Code Assist for Github and other Google products, sign up [here](https://google.qualtrics.com/jfe/form/SV_2cyuGuTWsEw84yG).

<b>You can also get AI-powered code generation, chat, as well as code reviews directly in the IDE at no cost with the [Gemini Code Assist IDE Extension](https://cloud.google.com/products/gemini/code-assist).</b>
</details>




[^1]: Review the [Privacy Notices](https://policies.google.com/privacy), [Generative AI Prohibited Use Policy](https://policies.google.com/terms/generative-ai/use-policy), [Terms of Service](https://policies.google.com/terms), and learn how to configure Gemini Code Assist in GitHub [here](https://developers.google.com/gemini-code-assist/docs/customize-gemini-behavior-github). Gemini can make mistakes, so double check it and [use code with caution](https://support.google.com/legal/answer/13505487).

URL: https://github.com/timnik82/pdf-analysis/pull/3#issuecomment-3767655307
--------------------------------------------------------------------------------

@codeant-ai[bot] - 2026-01-19T10:43:24Z
## **Sequence Diagram**

The PR adds a tool that extracts DOIs from a markdown file, calls the Mendeley-check script (updated to use a manual OAuth redirect URL paste for WSL), receives results, and writes an interactive HTML table next to the input file. This diagram shows the primary success path.

```mermaid
sequenceDiagram
    participant User
    participant Extractor as "extract_and_check_dois.py"
    participant Checker as "check_mendeley_dois_v2.py"
    participant MendeleyAPI as "Mendeley OAuth/API"
    participant FS as "Filesystem (HTML output)"

    User->>Extractor: Run with markdown file path
    Extractor->>Extractor: Parse markdown and extract DOIs
    Extractor->>Checker: Invoke checker with DOI list
    Checker->>User: Prompt: open URL, authorize, paste redirect URL (manual OAuth)
    User->>Checker: Paste redirect URL (auth code)
    Checker->>MendeleyAPI: Exchange auth code for access token & query library
    MendeleyAPI-->>Checker: Return which DOIs are in/not in library (JSON)
    Checker-->>Extractor: Return results JSON
    Extractor->>FS: Generate clickable HTML table next to input file
    Extractor-->>User: Print path to generated HTML (done)
```

---
*Generated by [CodeAnt AI](https://codeant.ai)*

URL: https://github.com/timnik82/pdf-analysis/pull/3#issuecomment-3767659137
--------------------------------------------------------------------------------

@kiloconnect[bot] - 2026-01-19T10:44:30Z
<!-- kilo-review -->
## Code Review Summary

**Status:** 4 Issues Found | **Recommendation:** Address before merge

### Overview
| Severity | Count |
|----------|-------|
| CRITICAL | 1 |
| WARNING | 2 |
| SUGGESTION | 1 |

<details>
<summary><b>Issue Details (click to expand)</b></summary>

#### CRITICAL
| File | Line | Issue |
|------|------|-------|
| `extract_and_check_dois.py` | 62 | No error handling for JSON loading. If `mendel |

#### WARNING
| File | Line | Issue |
|------|------|-------|
| `extract_and_check_dois.py` | 48 | Subprocess return code not checked. If `check_m |
| `extract_and_check_dois.py` | 205 | No check if markdown file exists before attempt |

#### SUGGESTION
| File | Line | Issue |
|------|------|-------|
| `extract_and_check_dois.py` | N/A | The HTML report directly embeds unescaped DO |

</details>

<details>
<summary><b>Other Observations (not in diff)</b></summary>

Issues found in unchanged code that cannot receive inline comments:

| File | Line | Issue |
|------|------|-------|

</details>

<details>
<summary><b>Files Reviewed (2 files)</b></summary>

- `check_mendeley_dois_v2.py` - 0 issues
- `extract_and_check_dois.py` - 4 issues

</details>
URL: https://github.com/timnik82/pdf-analysis/pull/3#issuecomment-3767664295
--------------------------------------------------------------------------------

@codeant-ai[bot] - 2026-01-19T10:44:51Z
## Nitpicks üîç

<table>
<tr><td>üîí&nbsp;<strong>No security issues identified</strong></td></tr>
<tr><td>‚ö°&nbsp;<strong>Recommended areas for review</strong><br><br>

- [ ] <a href='https://github.com/timnik82/pdf-analysis/pull/3/files#diff-809cb534456daccb28c445899fa38fb63cf7b5b1b75e3fb6a98e31ac0ac13a26R174-R186'><strong>Token storage permissions</strong></a><br>Tokens are written to a file and only protected with os.chmod(0o600) on non-Windows platforms. On Windows the token is saved without explicitly restrictive ACLs which can leak secrets. Consider using a secure storage backend (OS keyring) or apply platform-appropriate secure ACLs when saving tokens.<br>

- [ ] <a href='https://github.com/timnik82/pdf-analysis/pull/3/files#diff-32bac408e944a780069305e780b62e68c36c4d57fce2db2d4545c6a0e1e76d4dR151-R153'><strong>Unescaped HTML / XSS risk</strong></a><br>Values from the Mendeley results (DOI, title, year) are injected directly into the generated HTML without escaping. If any value contains HTML or special characters this can break the page or enable XSS if the source is untrusted.<br>

- [ ] <a href='https://github.com/timnik82/pdf-analysis/pull/3/files#diff-32bac408e944a780069305e780b62e68c36c4d57fce2db2d4545c6a0e1e76d4dR78-R80'><strong>Fragile summary access</strong></a><br>The code accesses summary fields directly (e.g. results['summary']['total_checked']) which will raise KeyError if the external checker returns a different structure or missing keys. The generator should tolerate missing or partial summary information and provide sensible defaults.<br>

- [ ] <a href='https://github.com/timnik82/pdf-analysis/pull/3/files#diff-809cb534456daccb28c445899fa38fb63cf7b5b1b75e3fb6a98e31ac0ac13a26R142-R151'><strong>Blocking / non-interactive use</strong></a><br>The code now relies on interactive stdin (input()) to receive the redirect URL. This will hang or fail in non-interactive environments (CI, automated scripts, WSL without an attached terminal). Provide a non-interactive alternative (CLI flag to accept an auth code or a saved auth URL, or an environment variable) so automation is possible.<br>

- [ ] <a href='https://github.com/timnik82/pdf-analysis/pull/3/files#diff-32bac408e944a780069305e780b62e68c36c4d57fce2db2d4545c6a0e1e76d4dR38-R38'><strong>Temp file handling</strong></a><br>The script writes a temp file named 'temp_dois.txt' in the current working directory. This can cause collisions, permission issues, or leftover files. Use a secure temporary file in a temp directory (or tempfile API) and ensure it is cleaned up even on errors.<br>

</td></tr>
</table>

URL: https://github.com/timnik82/pdf-analysis/pull/3#issuecomment-3767665966
--------------------------------------------------------------------------------

@codeant-ai[bot] - 2026-01-19T10:45:35Z
CodeAnt AI finished reviewing your PR.
URL: https://github.com/timnik82/pdf-analysis/pull/3#issuecomment-3767669438
--------------------------------------------------------------------------------


Code Review Comments (line-specific):
--------------------------------------

@kiloconnect[bot] - extract_and_check_dois.py:201
**WARNING:** No check if markdown file exists before attempting to open it. This can cause a FileNotFoundError if the user provides an invalid path.

Consider adding a check like `if not md_file.exists(): print(f"Error: File {md_file} not found"); sys.exit(1)` before extracting DOIs.
URL: https://github.com/timnik82/pdf-analysis/pull/3#discussion_r2704215892
--------------------------------------------------------------------------------

@kiloconnect[bot] - extract_and_check_dois.py:47
**WARNING:** Subprocess return code not checked. If `check_mendeley_dois_v2.py` fails, the script continues and may attempt to load a non-existent or invalid results file.

Add `if result.returncode != 0: return None` after the subprocess.run call.
URL: https://github.com/timnik82/pdf-analysis/pull/3#discussion_r2704215895
--------------------------------------------------------------------------------

@kiloconnect[bot] - extract_and_check_dois.py:61
**CRITICAL:** No error handling for JSON loading. If `mendeley_results.json` exists but contains invalid JSON, `json.load(f)` will raise a JSONDecodeError, crashing the script.

Wrap in try-except: `try: return json.load(f) except json.JSONDecodeError: print("Invalid JSON in results file"); return None`
URL: https://github.com/timnik82/pdf-analysis/pull/3#discussion_r2704215900
--------------------------------------------------------------------------------

@coderabbitai[bot] - extract_and_check_dois.py:70
_‚ö†Ô∏è Potential issue_ | _üü° Minor_

**Several reliability concerns in subprocess handling.**

1. **Missing cleanup of output file**: The `output_file` (`mendeley_results.json`) is not cleaned up in the `finally` block, leaving stale files.

2. **No subprocess error handling**: If `check_mendeley_dois_v2.py` exits with non-zero status, this is silently ignored.

3. **Hardcoded relative paths**: Both temp files use relative paths which may fail if the script is invoked from a different working directory than where `check_mendeley_dois_v2.py` resides.


<details>
<summary>üîß Proposed fix</summary>

```diff
 def run_mendeley_check(dois: list) -> dict:
     """Run the Mendeley check script and return results"""
-    # Create temporary file with DOIs
-    temp_file = Path('temp_dois.txt')
-    output_file = Path('mendeley_results.json')
+    # Create temporary files in same directory as this script
+    script_dir = Path(__file__).parent
+    temp_file = script_dir / 'temp_dois.txt'
+    output_file = script_dir / 'mendeley_results.json'
     
     try:
         # Write DOIs to file
         with open(temp_file, 'w') as f:
             f.write('\n'.join(dois))
         
         # Run the check script
         result = subprocess.run(
-            ['python3', 'check_mendeley_dois_v2.py', 
+            ['python3', str(script_dir / 'check_mendeley_dois_v2.py'), 
              '--file', str(temp_file), 
              '--output', str(output_file)],
             capture_output=True,
-            text=True
+            text=True,
+            check=False
         )
         
         print(result.stdout)
         if result.stderr:
             print(result.stderr, file=sys.stderr)
         
+        if result.returncode != 0:
+            print(f"Mendeley check script failed with exit code {result.returncode}")
+            return None
+        
         # Read results
         if output_file.exists():
             with open(output_file, 'r') as f:
                 return json.load(f)
         else:
             print("No results file generated")
             return None
     
     finally:
         # Clean up temp files
         if temp_file.exists():
             temp_file.unlink()
+        if output_file.exists():
+            output_file.unlink()
```
</details>

<details>
<summary>üß∞ Tools</summary>

<details>
<summary>ü™õ Ruff (0.14.13)</summary>

47-47: `subprocess` call: check for execution of untrusted input

(S603)

---

48-50: Starting a process with a partial executable path

(S607)

</details>

</details>

<details>
<summary>ü§ñ Prompt for AI Agents</summary>

```
In `@extract_and_check_dois.py` around lines 35 - 70, The run_mendeley_check
function has three issues: ensure output_file (mendeley_results.json) is removed
in the finally block, properly handle subprocess failures, and avoid fragile
relative paths; fix by (1) creating temp files with the tempfile module (e.g.,
tempfile.NamedTemporaryFile or tempfile.TemporaryDirectory) and use absolute
paths for both temp_file and output_file, (2) resolve the check script path
relative to the current module (Path(__file__).parent /
'check_mendeley_dois_v2.py') instead of a hardcoded relative name, (3) call
subprocess.run with check=True or inspect result.returncode and raise a
descriptive exception including result.stderr when non-zero, and (4) always
delete both temp_file and output_file (if created) in the finally block; use the
existing names temp_file, output_file and the run_mendeley_check function to
locate where to apply these changes.
```

</details>

<!-- fingerprinting:phantom:poseidon:ocelot -->

<!-- This is an auto-generated comment by CodeRabbit -->
URL: https://github.com/timnik82/pdf-analysis/pull/3#discussion_r2704216665
--------------------------------------------------------------------------------

@coderabbitai[bot] - extract_and_check_dois.py:154
_‚ö†Ô∏è Potential issue_ | _üü° Minor_

**Missing HTML escaping for user-controlled content.**

The `doc['title']` (line 152) and DOI values are inserted directly into HTML without escaping. If a title contains characters like `<`, `>`, or `&`, it could break the HTML rendering or potentially allow XSS if the content is malicious.


<details>
<summary>üîß Proposed fix using html.escape</summary>

Add import at top of file:
```python
import html
```

Then escape the values:
```diff
     if in_library:
         for doc in in_library:
             doi_url = f"https://doi.org/{doc['doi']}"
             year_str = f" ({doc['year']})" if doc.get('year') else ""
+            escaped_doi = html.escape(doc['doi'])
+            escaped_title = html.escape(doc['title'])
             html += f'''                    <li class="doi-item">
-                        <a href="{doi_url}" class="doi-link" target="_blank">{doc['doi']}</a>
-                        <div class="doi-title">{doc['title']}</div>
+                        <a href="{doi_url}" class="doi-link" target="_blank">{escaped_doi}</a>
+                        <div class="doi-title">{escaped_title}</div>
                         <div class="doi-meta">{year_str}</div>
                     </li>
 '''
```

Similarly for the `not_in_library` section (lines 168-174).
</details>

<details>
<summary>ü§ñ Prompt for AI Agents</summary>

```
In `@extract_and_check_dois.py` around lines 146 - 154, The HTML is built by
interpolating user-controlled fields directly (e.g., doc['title'] and
doc['doi']) causing potential XSS/HTML breaking; import the html module and
apply html.escape(..., quote=True) to doc['title'] and doc['doi'] (and any other
user fields like year) before constructing doi_url and the HTML snippets in the
in_library loop (the block that builds doi_url and the <li> entry) and mirror
the same escaping in the not_in_library section so all inserted values are
safely escaped.
```

</details>

<!-- fingerprinting:phantom:poseidon:ocelot -->

<!-- This is an auto-generated comment by CodeRabbit -->

‚úÖ Addressed in commit 161ac21
URL: https://github.com/timnik82/pdf-analysis/pull/3#discussion_r2704216671
--------------------------------------------------------------------------------

@gemini-code-assist[bot] - extract_and_check_dois.py:70
![high](https://www.gstatic.com/codereviewagent/high-priority.svg)

This function has several issues related to robustness and portability:

1.  **Hardcoded temporary files:** It creates `temp_dois.txt` and `mendeley_results.json` in the current working directory. This can cause race conditions, permission errors, and litters the directory.
2.  **Hardcoded interpreter & relative path:** It assumes `python3` and that `check_mendeley_dois_v2.py` is in the current path. This is not portable.
3.  **Incorrect type hint:** The function is hinted to return `dict`, but can return `None`.

Here is a suggested replacement that addresses these points using `tempfile` for safe temporary file handling and `sys.executable` for portability. You will need to add `import tempfile` at the top of the file.

```python
def run_mendeley_check(dois: list) -> dict | None:
    """Run the Mendeley check script and return results"""
    import tempfile
    try:
        with tempfile.TemporaryDirectory() as temp_dir:
            temp_path = Path(temp_dir)
            temp_file = temp_path / 'dois.txt'
            output_file = temp_path / 'mendeley_results.json'

            # Write DOIs to file
            with open(temp_file, 'w', encoding='utf-8') as f:
                f.write('\n'.join(dois))
            
            # Run the check script
            script_path = Path(__file__).resolve().parent / 'check_mendeley_dois_v2.py'
            result = subprocess.run(
                [sys.executable, str(script_path), 
                 '--file', str(temp_file), 
                 '--output', str(output_file)],
                capture_output=True,
                text=True,
                check=False
            )
            
            print(result.stdout)
            if result.stderr:
                print(result.stderr, file=sys.stderr)

            if result.returncode != 0:
                print("Mendeley check script failed.", file=sys.stderr)
                return None
            
            # Read results
            if not output_file.exists():
                print("No results file generated", file=sys.stderr)
                return None

            with open(output_file, 'r', encoding='utf-8') as f:
                return json.load(f)
    except (json.JSONDecodeError, FileNotFoundError) as e:
        print(f"Error processing Mendeley check: {e}", file=sys.stderr)
        return None
```
URL: https://github.com/timnik82/pdf-analysis/pull/3#discussion_r2704217421
--------------------------------------------------------------------------------

@gemini-code-assist[bot] - extract_and_check_dois.py:155
![high](https://www.gstatic.com/codereviewagent/high-priority.svg)

Data from the Mendeley API (DOI, title, year) is being inserted directly into the HTML template. This is a cross-site scripting (XSS) vulnerability. If any of this data contains malicious HTML, it will be executed by the browser. All dynamic data should be escaped before being embedded in HTML. You'll need to `import html` at the top of the file.

```suggestion
        for doc in in_library:
            import html
            doi_url = f"https://doi.org/{doc['doi']}"
            year_str = f" ({html.escape(str(doc['year']))})" if doc.get('year') else ""
            html += f'''                    <li class="doi-item">
                        <a href="{doi_url}" class="doi-link" target="_blank">{html.escape(doc['doi'])}</a>
                        <div class="doi-title">{html.escape(doc['title'])}</div>
                        <div class="doi-meta">{year_str}</div>
                    </li>
'''
```
URL: https://github.com/timnik82/pdf-analysis/pull/3#discussion_r2704217427
--------------------------------------------------------------------------------

@gemini-code-assist[bot] - extract_and_check_dois.py:174
![high](https://www.gstatic.com/codereviewagent/high-priority.svg)

Similar to the 'in library' section, the DOI here is inserted directly into HTML without escaping, creating a Cross-Site Scripting (XSS) vulnerability. Please escape it using `html.escape()`. You'll need to `import html` at the top of the file.

```suggestion
        for doi in not_in_library:
            import html
            doi_url = f"https://doi.org/{doi}"
            html += f'''                    <li class="doi-item">
                        <a href="{doi_url}" class="doi-link" target="_blank">{html.escape(doi)}</a>
                    </li>
'''
```
URL: https://github.com/timnik82/pdf-analysis/pull/3#discussion_r2704217431
--------------------------------------------------------------------------------

@gemini-code-assist[bot] - check_mendeley_dois_v2.py:155
![medium](https://www.gstatic.com/codereviewagent/medium-priority.svg)

With the removal of the local server and automatic browser opening in this new authentication flow, the `AuthHandler` class (lines 39-69) and the imports for `webbrowser`, `HTTPServer`, and `BaseHTTPRequestHandler` (lines 17, 19) are no longer used. They should be removed from the file to improve code clarity and maintainability.
URL: https://github.com/timnik82/pdf-analysis/pull/3#discussion_r2704217434
--------------------------------------------------------------------------------

@codeant-ai[bot] - extract_and_check_dois.py:172
**Suggestion:** The HTML report directly embeds unescaped DOI strings and titles into element text and href attributes, so a crafted DOI or title containing characters like quotes or angle brackets from the markdown or Mendeley API could break out of the HTML context and execute arbitrary JavaScript when the report is opened in a browser. [security]

<details>
<summary><b>Severity Level:</b> Critical üö®</summary>

```mdx
- ‚ùå Malicious HTML/JS execution when opening report.
- ‚ö†Ô∏è Reports show untrusted Mendeley metadata unsanitized.
- ‚ö†Ô∏è Local users viewing report risk data exposure.
```
</details>

```suggestion
    from html import escape

    # Add found DOIs
    if in_library:
        for doc in in_library:
            doi_text = escape(doc['doi'])
            title_text = escape(doc['title'])
            doi_url = escape(f"https://doi.org/{doc['doi']}", quote=True)
            year_str = f" ({doc['year']})" if doc.get('year') else ""
            html += f'''                    <li class="doi-item">
                        <a href="{doi_url}" class="doi-link" target="_blank">{doi_text}</a>
                        <div class="doi-title">{title_text}</div>
                        <div class="doi-meta">{year_str}</div>
                    </li>
    '''
    else:
        html += '                    <li class="empty-message">No DOIs found in library</li>\n'

    html += f'''                </ul>
            </div>
        
            <div class="column not-in-library">
                <h2>‚úó Not in Library <span class="count-badge">{missing_count}</span></h2>
                <ul class="doi-list">
    '''

    # Add missing DOIs
    if not_in_library:
        for doi in not_in_library:
            doi_text = escape(doi)
            doi_url = escape(f"https://doi.org/{doi}", quote=True)
            html += f'''                    <li class="doi-item">
                        <a href="{doi_url}" class="doi-link" target="_blank">{doi_text}</a>
```
<details>
<summary><b>Steps of Reproduction ‚úÖ </b></summary>

```mdx
1. Run the script on a markdown file: invoke `python extract_and_check_dois.py README.md`
(entry in file main, extract_and_check_dois.py:192-201) so execution reaches HTML
generation.

2. The script calls run_mendeley_check() and returns `results` (file main,
extract_and_check_dois.py:208-214); generate_html_table(results, ...) is called at
extract_and_check_dois.py:216-218.

3. Inside generate_html_table (extract_and_check_dois.py:72-190), the code concatenates
doc['doi'] and doc['title'] directly into href and text nodes (see lines at
generate_html_table where "# Add found DOIs" begins ‚Äî extract_and_check_dois.py:145-155),
without escaping.

4. If Mendeley metadata contains a title or DOI with characters like
`"><script>‚Ä¶</script>` or attributes including quotes, those strings will be inserted
verbatim into the href or inner HTML. Opening the generated file (mendeley_dois_table.html
written by generate_html_table at extract_and_check_dois.py:186-188) in a browser can
execute injected script.

5. Evidence: the final file writes html built from unescaped doc['doi']/doc['title'] and
not using any escaping library (search within file shows direct f-strings at lines
145-176). This reproduces XSS when Mendeley API returns crafted strings.
```
</details>
<details>
<summary><b>Prompt for AI Agent ü§ñ </b></summary>

```mdx
This is a comment left during a code review.

**Path:** extract_and_check_dois.py
**Line:** 145:172
**Comment:**
	*Security: The HTML report directly embeds unescaped DOI strings and titles into element text and href attributes, so a crafted DOI or title containing characters like quotes or angle brackets from the markdown or Mendeley API could break out of the HTML context and execute arbitrary JavaScript when the report is opened in a browser.

Validate the correctness of the flagged issue. If correct, How can I resolve this? If you propose a fix, implement it and please make it concise.
```
</details>
URL: https://github.com/timnik82/pdf-analysis/pull/3#discussion_r2704219486
--------------------------------------------------------------------------------
